kind: pipeline
name: Home Assistant 

steps:
  - name: yaml-linting
    image: python:3
    commands:
      - pip3 install --upgrade pip yamllint
      - yamllint config/

  - name: "HA config check"
    image: homeassistant/homeassistant
    commands:
      - echo "Preparing ..."
      - cp config/drone_secrets.yaml config/secrets.yaml
      - echo "Testing Home Assistant config ..."
      - hass -c config/ --script check_config
      - echo "Cleaning up ..."
      - rm config/secrets.yaml

  - name: push-github
    pull: always
    image: appleboy/drone-git-push
    settings:
      branch: master
      author_email: "45527+nagubal@users.noreply.github.com"
      author_name: nagubal
      commit: true
      commit_message: "{{commit.message}}"
      followtags: true
      remote: "git@github.com:nagubal/home-assistant-config.git"
    environment:
      GIT_PUSH_SSH_KEY:
        from_secret: git_push_ssh_key

---

kind: pipeline
name: Home Assistant Dev 

steps:
  - name: "HA config check: Dev"
    image: homeassistant/homeassistant:dev
    pull: always
    failure: ignore
    commands:
      - echo "Preparing ..."
      - cp config/drone_secrets.yaml config/secrets.yaml
      - echo "Testing Home Assistant config ..."
      - hass -c config/ --script check_config
      - echo "Cleaning up ..."
      - rm config/secrets.yaml
